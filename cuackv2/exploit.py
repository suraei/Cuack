import subprocess
import os
from utils import print_info, print_success, print_error

def run_searchsploit(nmap_xml_file, results_directory, domain):
    output_file = os.path.join(results_directory, f"{domain}.searchsploit")
    command = f"searchsploit --nmap {nmap_xml_file} --disable-colour 2>/dev/null"
    try:
        print_info("Buscando exploits conocidos para los servicios identificados...")
        # Ejecuta el comando y guarda la salida
        with open(output_file, "w") as file:
            subprocess.run(command, stdout=file, stderr=subprocess.PIPE, shell=True, check=True)
        print_success(f"Resultados de Searchsploit guardados en {output_file}")
    except subprocess.CalledProcessError as e:
        print_error(f"Error al ejecutar Searchsploit: {e}")