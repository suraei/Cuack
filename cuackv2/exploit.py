import subprocess
import os
from utils import print_info, print_success, print_error

def run_searchsploit(nmap_xml_file, results_directory, domain):
    output_file = os.path.join(results_directory, f"{domain}.searchsploit")
    command = f"searchsploit --nmap {nmap_xml_file} --disable-colour"

    try:
        print_info("Buscando exploits conocidos para los servicios identificados...")
        # Ejecuta el comando y captura la salida
        result = subprocess.run(command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, shell=True, check=True, text=True)

        # Imprime la salida en la terminal
        print(result.stdout)

        # Guarda la salida en el archivo
        with open(output_file, "w") as file:
            file.write(result.stdout)

        print_success(f"Resultados de Searchsploit guardados en {output_file}")
    except subprocess.CalledProcessError as e:
        print_error(f"Error al ejecutar Searchsploit: {e}")

